<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="navbar.css" />
    <link rel="stylesheet" href="footer.css" />
    <link rel="stylesheet" href="franchise.css" />
    
    <title>Franchise Inquiry | Rane's CreamBerg</title>
  </head>
  <body>
    
    <div id="navbar-placeholder"></div>

    <header class="page__header">
        <h1 class="section__header">Join the CreamBerg Family</h1>
        <p class="section__description">Start your journey with the fastest growing ice cream brand.</p>
    </header>

    <section class="section__container franchise__container">
      <div class="franchise__content">
        <h2 class="form__title">Franchise Application</h2>
        
        <form id="franchise-form" action="https://api.web3forms.com/submit" method="POST">
            <input type="hidden" name="access_key" value="80d2768b-5d30-4359-9a58-d81b20d401bb">

            <div class="form__section">
                <h3>Personal Details</h3>
                <div class="form__grid">
                    <input type="text" name="name" placeholder="Your Name" required />
                    <input type="email" name="email" placeholder="Your Email" required />
                </div>
                <div class="form__grid">
                    <input type="tel" name="phone" placeholder="Your Phone Number" required />
                    <input type="text" name="address" placeholder="Your Address" required />
                </div>
            </div>

            <hr class="form__divider">

            <div class="form__section">
                <h3>Business & Work Experience</h3>
                <input type="text" name="current_job" placeholder="Current Job/Business" class="full__width" />
                
                <div class="form__grid">
                    <div class="input__group">
                        <label>Have you ever owned a business?</label>
                        <select name="owned_business">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="input__group">
                        <label>If Yes, then what type?</label>
                        <input type="text" name="business_type" placeholder="Type of business" />
                    </div>
                </div>
            </div>

            <hr class="form__divider">

            <div class="form__section">
                <h3>Location Information</h3>
                <div class="form__grid">
                    <input type="text" name="city" placeholder="City" required />
                    <input type="text" name="location_preference" placeholder="Location Preference" />
                </div>

                <div class="input__group">
                    <label>Do you own an existing commercial space?</label>
                    <select name="own_space">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>

                <div class="input__group">
                    <label>If "Yes", describe location (Corner shop / Main road):</label>
                    <textarea name="shop_description" rows="3" placeholder="Describe the location..."></textarea>
                </div>

                <input type="text" name="area_sqft" placeholder="Retail Space Area (Sq. Ft)" class="full__width" />
            </div>

            <div class="checkbox__group">
                <input type="checkbox" id="agreement" name="agreement" required>
                <label for="agreement">
                    By submitting this form, I certify that the information furnished in this Rane's Creamberg Ice Cream franchise request is true and correct.
                </label>
            </div>
            
            <button class="btn franchise__btn">Submit Application</button>

            <p id="form-message" style="display:none; text-align: center; margin-top: 1rem; font-weight: 600;"></p>
        </form>
      </div>
    </section>

    <div id="footer-placeholder"></div>

    <script>
        // 1. LOAD NAVBAR & FOOTER
        // We use a helper function to ensure scripts run AFTER navbar loads
        const loadComponent = (file, elementId, callback) => {
            fetch(file)
            .then(res => res.text())
            .then(data => {
                document.getElementById(elementId).innerHTML = data;
                if (callback) callback();
            });
        };

        // Load Navbar
        loadComponent("navbar.html", "navbar-placeholder", () => {
            // Initialize Mobile Menu (Exactly like index.html)
            const menuBtn = document.getElementById("menu-btn");
            const navLinks = document.getElementById("nav-links");
            const menuBtnIcon = menuBtn ? menuBtn.querySelector("i") : null;

            if (menuBtn && navLinks) {
                menuBtn.addEventListener("click", () => {
                    navLinks.classList.toggle("open");
                    const isOpen = navLinks.classList.contains("open");
                    // Switch Icon logic
                    menuBtnIcon.setAttribute("class", isOpen ? "ri-close-line" : "ri-menu-3-line");
                });
                
                // Close menu when a link is clicked
                navLinks.addEventListener("click", () => {
                    navLinks.classList.remove("open");
                    menuBtnIcon.setAttribute("class", "ri-menu-3-line");
                });
            }
        });

        // Load Footer
        loadComponent("footer.html", "footer-placeholder");

        /* --- 2. PROFESSIONAL FORM LOGIC --- */
        const contactForm = document.getElementById("franchise-form");
        const formMessage = document.getElementById("form-message");

        if (contactForm) {
            const formBtn = contactForm.querySelector("button");
            const inputs = contactForm.querySelectorAll("input, select, textarea");

            // Helper: Show Error (Red Text) instead of Alert
            const showError = (input, message) => {
                input.classList.add("input-error"); // Adds red border
                formMessage.innerText = message;
                formMessage.style.display = "block";
                formMessage.style.color = "red";
                formBtn.innerText = "Send Application";
            };

            // Remove error when user types
            inputs.forEach(input => {
                input.addEventListener("input", () => {
                    input.classList.remove("input-error");
                    formMessage.style.display = "none";
                });
            });

            contactForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                
                const nameInput = contactForm.querySelector('input[name="name"]');
                const phoneInput = contactForm.querySelector('input[name="phone"]');

                // Validation
                if(nameInput.value.trim().length < 3) {
                    showError(nameInput, "Please enter a valid full name.");
                    return;
                }
                if(phoneInput.value.trim().length < 10) {
                    showError(phoneInput, "Please enter a valid phone number.");
                    return;
                }

                // Send Data
                const originalBtnText = formBtn.innerText;
                formBtn.innerText = "Sending...";
                
                const formData = new FormData(contactForm);
                const json = JSON.stringify(Object.fromEntries(formData));

                try {
                    const response = await fetch("https://api.web3forms.com/submit", {
                        method: "POST",
                        headers: { "Content-Type": "application/json", Accept: "application/json" },
                        body: json
                    });
                    
                    if (response.status === 200) {
                        formMessage.innerText = "Application sent successfully!";
                        formMessage.style.color = "var(--primary-color)";
                        formMessage.style.display = "block";
                        contactForm.reset();
                    } else {
                        formMessage.innerText = "Error sending message. Please try again.";
                        formMessage.style.color = "red";
                        formMessage.style.display = "block";
                    }
                } catch (error) {
                    formMessage.innerText = "Something went wrong! Check your connection.";
                    formMessage.style.display = "block";
                    formMessage.style.color = "red";
                } finally {
                    setTimeout(() => { formBtn.innerText = originalBtnText; }, 5000);
                }
            });
        }
    </script>
  </body>
</html>